# the license inside this block applies to this file
# Copyright 2024 Google Inc.
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

---
name: 'Index'
description: |
	Describes a composite index for Cloud Datastore.
references:
	guides:
		- 'Official Documentation': 'https://cloud.google.com/datastore/docs/concepts/indexes'
	api: 'https://cloud.google.com/datastore/docs/reference/admin/rest/v1/projects.indexes'
docs:
	warning: 'This resource creates a Datastore Index on a project that has already
enabled a Datastore-compatible database. If you haven't already enabled
one, you can create a `google_app_engine_application` resource with
`database_type` set to `"CLOUD_DATASTORE_COMPATIBILITY"` to do so. Your
Datastore location will be the same as the App Engine location specified.
'
id_format: 'projects/{{project}}/indexes/{{index_id}}'
base_url: 'projects/{{project}}/indexes'
self_link: 'projects/{{project}}/indexes/{{index_id}}'
immutable: true
timeouts:
	insert_minutes: 20
	update_minutes: 20
	delete_minutes: 20
autogen_async: true
async:
	operation: 
		base_url: '{{op_id}}'
		path: 'name'
		wait_ms: '1000'
	result: 
		path: 'response'
		resource_inside_response: true
	error: 
		path: 'error'
		message: 'message'
collection_url_key: 'indexes'
custom_code:
error_retry_predicates:

		- 'transport_tpg.DatastoreIndex409Contention'
examples:
	- name: 'datastore_index'
		primary_resource_id: 'default'
		primary_resource_name: 'default'
		vars:
			- property_name_1: 'property_a'
			- property_name_2: 'property_b'
parameters:
properties:
	- name: 'indexId'
		type: String
		description: 'The index id.'
		output: true
	- name: 'kind'
		type: String
		description: 'The entity kind which the index applies to.'
		required: true
	- name: 'ancestor'
		type: Enum
		description: 'Policy for including ancestors in the index.'
		default_value: NONE
		values:
			- 'NONE'
			- 'ALL_ANCESTORS'
			- ''
	- name: 'properties'
		type: Array
		description: 'An ordered list of properties to index on.'
		item_type: NestedObject
			properties:
      	- name: 'name'
      		type: String
      		description: 'The property name to index.'
      		required: true
      	- name: 'direction'
      		type: Enum
      		description: 'The direction the index should optimize for sorting.'
      		required: true
      		values:
      			- 'ASCENDING'
      			- 'DESCENDING'
		min_size: 1
