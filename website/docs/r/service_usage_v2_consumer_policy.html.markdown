---
# ----------------------------------------------------------------------------
#
#     ***     AUTO GENERATED CODE    ***    Type: MMv1     ***
#
# ----------------------------------------------------------------------------
#
#     This file is automatically generated by Magic Modules and manual
#     changes will be clobbered when the file is regenerated.
#
#     Please read more about how to change this file in
#     .github/CONTRIBUTING.md.
#
# ----------------------------------------------------------------------------
subcategory: "Service Usage"
description: |-
  Consumer Policy is a set of rules that define what services or service groups can be used for a cloud resource hierarchy.
---

# google_service_usage_v2_consumer_policy

Consumer Policy is a set of rules that define what services or service groups can be used for a cloud resource hierarchy.

~> **Warning:** This resource is in beta, and should be used with the terraform-provider-google-beta provider.
See [Provider Versions](https://terraform.io/docs/providers/google/guides/provider_versions.html) for more details on beta resources.

To get more information about ConsumerPolicy, see:

* [API documentation](https://cloud.google.com/service-usage/docs/reference/rest#rest-resource:-v2alpha.consumerpolicies)
* How-to Guides
    * [QUICKSTART_TITLE](QUICKSTART_URL)

## Example Usage - Serviceusagev2 Consumerpolicy Basic


```hcl
provider "google-beta" {
  user_project_override = true
  billing_project = "my-project-name"

}

resource "google_folder" "basic" {
  provider = google-beta
  parent       = "organizations/123456789"
  display_name = "suv2"
  deletion_protection = false
}

# Wait delay after enabling APIs
resource "time_sleep" "wait_60s" {
  depends_on       = [google_folder.basic]
  create_duration  = "60s"
}

resource "google_service_usage_v2_consumer_policy" "default" {
  provider = google-beta
  parent = "folders/${google_folder.basic.folder_id}"
  name   = "default"
  enable_rules  {
    services = ["services/oslogin.googleapis.com"]
  }
  validate_dependencies = true
  check_usage_on_remove = false

  depends_on = [time_sleep.wait_60s]
}
```

## Argument Reference

The following arguments are supported:


* `parent` -
  (Required)
  (Required) The name of the parent. It can be a project, folder or organization in the format of  projects/<project_id or project_number>, folders/<folder_number> or organizations/<org_number> .

* `name` -
  (Required)
  (Required) The name of the policy. Currently only the “default” policy name is supported.

* `enable_rules` -
  (Required)
  (Required) The consumer policy rule that defines enabled services. The structure is documented below.
  Structure is [documented below](#nested_enable_rules).


<a name="nested_enable_rules"></a>The `enable_rules` block supports:

* `services` -
  (Optional)
  (Optional): List of service names to be enabled in the format of services/<service_name>

- - -


* `validate_dependencies` -
  (Optional)
  (Optional) Default value is true. If true, this flag enforces dependency management within the consumer policy. When adding a new service, it verifies that all its dependencies are already present/added in the policy. Conversely, when removing a service, it ensures that no other services within the policy depend on the service to be removed. If the validation fails, a comprehensive message will be presented, outlining the missing dependencies and providing instructions on how to address the issue.

* `check_usage_on_remove` -
  (Optional)
  (Optional) Default value is false. If true, the usage of the service to be removed will be checked. If the service has been used within the past 30 days or was enabled in the last 3 days, an error will be thrown.


## Attributes Reference

In addition to the arguments listed above, the following computed attributes are exported:

* `id` - an identifier for the resource with format `{{parent}}/consumerPolicies/{{name}}`


## Timeouts

This resource provides the following
[Timeouts](https://developer.hashicorp.com/terraform/plugin/sdkv2/resources/retries-and-customizable-timeouts) configuration options:

- `create` - Default is 20 minutes.
- `update` - Default is 20 minutes.
- `delete` - Default is 20 minutes.

## Import


ConsumerPolicy can be imported using any of these accepted formats:

* `{{parent}}/consumerPolicies/{{name}}`


In Terraform v1.5.0 and later, use an [`import` block](https://developer.hashicorp.com/terraform/language/import) to import ConsumerPolicy using one of the formats above. For example:

```tf
import {
  id = "{{parent}}/consumerPolicies/{{name}}"
  to = google_service_usage_v2_consumer_policy.default
}
```

When using the [`terraform import` command](https://developer.hashicorp.com/terraform/cli/commands/import), ConsumerPolicy can be imported using one of the formats above. For example:

```
$ terraform import google_service_usage_v2_consumer_policy.default {{parent}}/consumerPolicies/{{name}}
```
